name: Build and Release
on:
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
jobs:
  build:
    runs-on: ubuntu-latest
    env:  # å…¨å±€ç¯å¢ƒå˜é‡
      SOURCE_DIR: ${{ github.workspace }}/libraries  # ä½¿ç”¨ GitHub é¢„å®šä¹‰çš„å·¥ä½œç›®å½•
      TARGET_DIR: ${{ github.workspace }}/target
      MOVE_LIST: ${{ github.workspace }}/move.txt
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          repository: FongMi/media
          ref: 1.8.0-fongmi
          fetch-depth: 0
      - name: Set up JDK 17
        uses: actions/setup-java@v5
        with:
          java-version: 17
          distribution: 'temurin'
      - name: Build AAR
        run: |
          ./gradlew assembleRelease
          echo "Source dir: $SOURCE_DIR"
          echo "Target dir: $TARGET_DIR"
          echo "Move list: $MOVE_LIST"
          find "$SOURCE_DIR" -name "lib-*-release.aar" | while read -r aar_file; do
            filename=$(basename "$aar_file")
            if grep -qFx "$filename" "$MOVE_LIST"; then
              cp -v "$aar_file" "$TARGET_DIR/"
            else
              echo "Skipped: $filename"
            fi
          done
          echo "ğŸ“¦ ç”Ÿæˆçš„AARæ–‡ä»¶ï¼š"
          ls -lh $TARGET_DIR
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: lib-aars
          path: ${{ env.TARGET_DIR }}